!function(t){"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&module.exports?module.exports=t():window.flipbook=t.call(this)}(function(){return function(f){var n,i,r,s,u,d,a,c,e,l,o,h,p,m,g,w,t,v,x={},b=-1,y=function(){var e,t=f.sprite?["id","path","extension","filename","rows"]:["id","path","extension","filename","count"];return t.forEach(function(t){f[t]||(e=t)}),e},M=function(){f.speed=isNaN(f.speed)?.5:Math.min(Math.max(0,parseFloat(f.speed)),1),f.sprite?f.count=f.rows.reduce(function(t,e){return t+e}):f.count=parseInt(f.count),f.path=f.path.trim(),f.path.lastIndexOf("/")!==f.path.length-1&&(f.path+="/")},A=function(){f.loaded&&"function"==typeof f.loaded&&f.loaded(),t=!0,X(),k(),S(0)},F=function(){(n=document.getElementById(f.id)).classList.add("flipbook-container"),(i=document.createElement("div")).classList.add("flipbook-graphic"),n.appendChild(i),r=Y(i),s=r.getContext("2d")},I=function(){T(n,{position:"relative",overflow:"hidden"}),T(i,{position:"absolute",top:0,left:0}),T(r,{position:"absolute",top:0,left:0})},k=function(){window.addEventListener("resize",X,!1),window.addEventListener("scroll",B,!1)},q=function(t){var e=f.sprite?f.rows.length:e=f.count;g=L(e),w=[],E(0,e,t)},E=function(n,i,r){var a=g[n];j(a,function(t,e){if(t)r("error loading image");else{a.img=e,0===n&&C(e,a.rows);for(var o=0;o<a.rows;o++)w.push({imageIndex:n,x:0,y:o});H(n,i),++n<g.length?E(n,i,r):r()}})},C=function(t,e){h=t.naturalWidth,p=t.naturalHeight/e,m=Math.round(h/p*1e3)/1e3},H=function(t,e){f.progress&&"function"==typeof f.progress&&f.progress({frame:t+1,total:f.count,percent:Math.round(t/(e-1)*100)})},L=function(t){for(var e=[],o=0;o<t;o++){var n=R(o+1);e[o]={src:n,rows:f.sprite?f.rows[o]:1}}return e},R=function(t){for(var e=f.filename.match(/\%\dd/)[0].charAt(1),o=t.toString().length,n=Math.max(e-o,0),i=f.filename.split(/\%\dd/)[0],r=f.path+i,a=0;a<n;a++)r+="0";return r+=t+"."+f.extension},Y=function(t){var e=document.createElement("canvas");return e.classList.add("flipbook-canvas"),t.appendChild(e),e},X=function(){var t,e;u=n.offsetWidth,f.cover?(d=innerHeight,(t=u/d)<m?(x.width=Math.floor(t*p),x.height=p,x.offsetX=Math.floor((h-x.width)/2),x.offsetY=0):(x.height=Math.floor(h/t),x.width=h,x.offsetX=0,x.offsetY=Math.floor((p-x.height)/2))):d=Math.floor(u/m),e=innerHeight-d,c=d+e,r.width=u,r.height=d,r.style.top=getComputedStyle(n).marginTop,i.style.height=c+"px",i.style.width=u+"px";var o=W();a=innerHeight*o,n.style.height=a+"px",z(),l&&(N(),O(pageYOffset-l,!0))},z=function(){var t=n.getBoundingClientRect();e=t.left,l=t.top,o=t.bottom-i.offsetHeight},B=function(){v||requestAnimationFrame(N),v=!0},N=function(){v=!1,t&&(z(),l<0&&0<o?(T(i,{position:"fixed",top:0,left:e+"px",bottom:"auto"}),O(Math.abs(l))):o<0?(T(i,{position:"absolute",top:"auto",left:0,bottom:0}),O(a)):0<l&&(T(i,{position:"absolute",top:0,left:0,bottom:"auto"}),O(0)))},O=function(t,e){var o=t/(a-c),o=Math.min(Math.max(o,0),1),n=Math.floor(o*(f.count-1));!e&&b===n||S(b=n)},S=function(t){var e,o,n;s.clearRect(0,0,u,d);var i=w[t],r=g[i.imageIndex],a=f.cover?(e=x.offsetX,o=x.offsetY+p*i.y,n=x.width,x.height):(e=0,o=p*i.y,n=h,p);s.drawImage(r.img,e,o,n,a,0,0,u,d)},T=function(t,e){for(var o in e)t.style[o]=e[o]},W=function(){return 2+10*(1-f.speed)},j=function(t,e){var o=new Image;o.onload=function(){e(null,o)},o.onerror=function(){e("error loading image: "+t.src)},o.src=t.src},D=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)}},G=function(t){console.log(G),console&&console.error&&console.error("::flipbook:: "+t)};!function(){window.requestAnimatoinFrame=D();var t=y();t?G("invalid options, missing "+t):(M(),F(),I(),q(function(t){t?G(t):A()}))}()}});